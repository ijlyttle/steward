<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Metadata Comparison • steward</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Metadata Comparison">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">steward</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9015</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/steward.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/metadata-comparison.html">Metadata Comparison</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/uncoast-unconf/steward">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="metadata-comparison_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Metadata Comparison</h1>
                        <h4 class="author">Ian Lyttle</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/uncoast-unconf/steward/blob/master/vignettes/metadata-comparison.Rmd"><code>vignettes/metadata-comparison.Rmd</code></a></small>
      <div class="hidden name"><code>metadata-comparison.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"steward"</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"conflicted"</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"dplyr"</span>)</span></code></pre></div>
<p>Let’s say you have two data frames, and you would like to know how compatible they are with each other. This problem had been floating around my head when I saw this <a href="https://twitter.com/sharlagelfand/status/1229512910591885317">tweet from Sharla Gelfand</a>:</p>
<blockquote>
<p>anyone aware of an #rstats package that will compare two data frames’ names/types and output nice, descriptive errors if they don’t match? do i have to build this myself? - <span class="citation">@sharlagelfand</span></p>
</blockquote>
<p>Sharla followed this up with a comprehensive <a href="https://sharla.party/post/comparing-two-dfs">blog post</a> where she details what she wants to do, then shows how existing solutions perform. Happily, Sharla’s view of the problem matches perfectly my view of the problem. What’s more, Sharla has specified what she wants in a solution, with reprexes! As “calls to action” go, what’s not to like?!</p>
<p>Here’s my proposed solution to the problem, an experimental function called <code><a href="../reference/col_spec_compare.html">col_spec_compare()</a></code> - it’s called this because it’s based on the implementation of column-specifications in <a href="https://readr.tidyverse.org">readr</a> and <a href="https://vroom.r-lib.org">vroom</a>.</p>
<p><strong>NOTE</strong>: As of Feb. 2020, this is an experimental function in a maturing package which is not yet on CRAN. I am writing this up to get feedback on what such a function <em>should</em> do, rather than as an annoucement of a solution you should feel confident to use in your day-to-day work.</p>
<p>Following Sharla’s lead, when we compare a data frame with itself, we get nothing but success:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw"><a href="../reference/col_spec_compare.html">col_spec_compare</a></span>(mtcars, mtcars)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#&gt; </span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#&gt; ── Column comparison ───────────────────────────────────────────────────────────</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt; ✔ Column names and specifications are identical and have same order.</span></span></code></pre></div>
<p>This function has two arguments <code>x</code> and <code>y</code>; these names are used to identify the data frames when there are differences. For example, what if there is a missing column?</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>mtcars_missing_cols &lt;-</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="st">  </span>mtcars <span class="op">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>mpg)</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw"><a href="../reference/col_spec_compare.html">col_spec_compare</a></span>(mtcars_missing_cols, mtcars)</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt; </span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt; ── Column comparison ───────────────────────────────────────────────────────────</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt; ! Column names in y but not x:</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt;    mpg  col_double()</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt; ✔ Column names in both x and y have identical specifications.</span></span></code></pre></div>
<p>You can see that the “missing” column is identified by name, <code>mpg</code>, then described by a column specification, <code>col_double()</code>. We see a second piece of information that tells us that for column names that are common to <code>x</code> and <code>y</code>, the specifications are identical.</p>
<p>The column specifications are defined in readr (and vroom). If fact, we are using a function in the dev version of readr to determine the column specifications for each of <code>x</code> and <code>y</code> (building on what the Tidyverse team have already done):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>readr<span class="op">::</span><span class="kw"><a href="https://readr.tidyverse.org/reference/as.col_spec.html">as.col_spec</a></span>(mtcars)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">#&gt; cols(</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt;   mpg = col_double(),</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#&gt;   cyl = col_double(),</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt;   disp = col_double(),</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt;   hp = col_double(),</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt;   drat = col_double(),</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt;   wt = col_double(),</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt;   qsec = col_double(),</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt;   vs = col_double(),</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt;   am = col_double(),</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt;   gear = col_double(),</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt;   carb = col_double()</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt; )</span></span></code></pre></div>
<p>Resuming the examples, what if there is an extra column?</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>mtcars_extra_cols &lt;-</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="st">  </span>mtcars <span class="op">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">mpgo =</span> mpg)</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="kw"><a href="../reference/col_spec_compare.html">col_spec_compare</a></span>(mtcars_extra_cols, mtcars)</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt; </span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt; ── Column comparison ───────────────────────────────────────────────────────────</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt; ! Column names in x but not y:</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt;    mpgo  col_double()</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt; ✔ Column names in both x and y have identical specifications.</span></span></code></pre></div>
<p>At this point it may be useful to “peek under the hood” a little bit (this article has a <a href="#under-the-hood">larger section on this</a>). The function <code><a href="../reference/col_spec_compare.html">col_spec_compare()</a></code> returns an object with S3 class <code>col_spec_diff</code>, which is just a way of saying “it’s a <code><a href="https://rdrr.io/r/base/list.html">list()</a></code> with extra functionality.” We can use the <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> function to have a closer look:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>diff_extra_cols &lt;-<span class="st"> </span><span class="kw"><a href="../reference/col_spec_compare.html">col_spec_compare</a></span>(mtcars_extra_cols, mtcars)</span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(diff_extra_cols)</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt; List of 3</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt;  $ identical   : logi FALSE</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt;  $ names       :List of 4</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt;   ..$ identical : logi FALSE</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt;   ..$ equivalent: logi FALSE</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt;   ..$ x_not_y   :</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt;   .. .. cols(</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt;   .. ..   mpgo = col_double()</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt;   .. .. )</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">#&gt;   ..$ y_not_x   :</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">#&gt;   .. .. cols()</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt;  $ specs_common:List of 3</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt;   ..$ identical: logi TRUE</span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">#&gt;   ..$ x_diff_y :</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">#&gt;   .. .. cols()</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">#&gt;   ..$ y_diff_x :</span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="co">#&gt;   .. .. cols()</span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">#&gt;  - attr(*, "class")= chr "col_spec_diff"</span></span></code></pre></div>
<p>This list describes the match between the columns of data frame <code>x</code> and data frame <code>y</code>. It has a print method that provides (hopefully) user-friendly and informative feedback.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(diff_extra_cols)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co">#&gt; </span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">#&gt; ── Column comparison ───────────────────────────────────────────────────────────</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">#&gt; ! Column names in x but not y:</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#&gt;    mpgo  col_double()</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; ✔ Column names in both x and y have identical specifications.</span></span></code></pre></div>
<p>The observant reader will have noticed that <code><a href="../reference/col_spec_compare.html">col_spec_compare()</a></code> gives us feedback, but it does not <em>act</em> on any of its information. It does not throw errors or issue warnings. This is because <em>I</em> have no idea what an acceptable match means to you in your situation. Maybe it’s OK that there’s an extra column, maybe not? I’ll talk about this more <a href="#extension">later in this article</a>.</p>
<p>What if we have both a missing column and and extra column?</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>mtcars_missing_extra_cols &lt;-</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="st">  </span>mtcars <span class="op">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>cyl) <span class="op">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">mpgo =</span> mpg)</span>
<span id="cb8-5"><a href="#cb8-5"></a></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="kw"><a href="../reference/col_spec_compare.html">col_spec_compare</a></span>(mtcars_missing_extra_cols, mtcars)</span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="co">#&gt; </span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co">#&gt; ── Column comparison ───────────────────────────────────────────────────────────</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co">#&gt; ! Column names in x but not y:</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="co">#&gt;    mpgo  col_double()</span></span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="co">#&gt; ! Column names in y but not x:</span></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co">#&gt;     cyl  col_double()</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="co">#&gt; ✔ Column names in both x and y have identical specifications.</span></span></code></pre></div>
<p>Let’s say that the columns are ordered differently:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>mtcars_diff_order &lt;-</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="st">  </span>mtcars <span class="op">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(cyl, <span class="kw"><a href="https://dplyr.tidyverse.org/reference/reexports.html">everything</a></span>())</span>
<span id="cb9-4"><a href="#cb9-4"></a></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="kw"><a href="../reference/col_spec_compare.html">col_spec_compare</a></span>(mtcars_diff_order, mtcars)</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt; </span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt; ── Column comparison ───────────────────────────────────────────────────────────</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt; ℹ Column names are identical but have different order.</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt; ✔ Column names in both x and y have identical specifications.</span></span></code></pre></div>
<p>Or if a column has the same name, but has a different class:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>mtcars_wrong_class &lt;-</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="st">  </span>mtcars <span class="op">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">mpg =</span> <span class="kw"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(mpg))</span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="kw"><a href="../reference/col_spec_compare.html">col_spec_compare</a></span>(mtcars_wrong_class, mtcars)</span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co">#&gt; </span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="co">#&gt; ── Column comparison ───────────────────────────────────────────────────────────</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co">#&gt; ✔ Column names are identical and have same order.</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co">#&gt; ! Column specifications different in x:</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="co">#&gt;    mpg  col_character()</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co">#&gt; ! Column specifications different in y:</span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co">#&gt;    mpg  col_double()</span></span></code></pre></div>
<p>The feedback here focuses on those columns names that are common to both data frames, but have different specifications.</p>
<p>We have a couple more examples - first, Sharla has a “throw the kitchen sink at it” problem:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>mtcars_missing_extra_cols_wrong_class &lt;-</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="st">  </span>mtcars <span class="op">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>cyl) <span class="op">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">mpgo =</span> mpg) <span class="op">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">mpg =</span> <span class="kw"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(mpg))</span>
<span id="cb11-6"><a href="#cb11-6"></a></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="kw"><a href="../reference/col_spec_compare.html">col_spec_compare</a></span>(mtcars_missing_extra_cols_wrong_class, mtcars)</span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co">#&gt; </span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">#&gt; ── Column comparison ───────────────────────────────────────────────────────────</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">#&gt; ! Column names in x but not y:</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">#&gt;    mpgo  col_double()</span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">#&gt; ! Column names in y but not x:</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">#&gt;     cyl  col_double()</span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co">#&gt; ! Column specifications different in x:</span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="co">#&gt;     mpg  col_character()</span></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="co">#&gt; ! Column specifications different in y:</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="co">#&gt;     mpg  col_double()</span></span></code></pre></div>
<p>I offer a final example myself, in the spirit of something I am likely to do:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw"><a href="../reference/col_spec_compare.html">col_spec_compare</a></span>(mtcars, cars)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co">#&gt; </span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co">#&gt; ── Column comparison ───────────────────────────────────────────────────────────</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">#&gt; ! Column names in x but not y:</span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co">#&gt;      mpg  col_double() </span></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="co">#&gt;      cyl  col_double() </span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">#&gt;     disp  col_double() </span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co">#&gt;       hp  col_double() </span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="co">#&gt;     drat  col_double() </span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="co">#&gt;       wt  col_double() </span></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="co">#&gt;     qsec  col_double() </span></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="co">#&gt;       vs  col_double() </span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="co">#&gt;       am  col_double() </span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="co">#&gt;     gear  col_double() </span></span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="co">#&gt;     carb  col_double()</span></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="co">#&gt; ! Column names in y but not x:</span></span>
<span id="cb12-17"><a href="#cb12-17"></a><span class="co">#&gt;    speed  col_double() </span></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="co">#&gt;     dist  col_double()</span></span>
<span id="cb12-19"><a href="#cb12-19"></a><span class="co">#&gt; ! There are no column names common to both x and y.</span></span></code></pre></div>
<div id="under-the-hood" class="section level2">
<h2 class="hasAnchor">
<a href="#under-the-hood" class="anchor"></a>Under the hood</h2>
<p>This function takes advantage of the column-specifications already defined in readr and vroom. This introduces a limitation, we can consider a column only if it is one of:</p>
<ul>
<li>logical</li>
<li>integer</li>
<li>double</li>
<li>character</li>
<li>date</li>
<li>time</li>
<li>datetime</li>
<li>factor (including ordered)</li>
</ul>
<p>This covers quite a lot, so I don’t think this is a huge limitation.</p>
<p>As discussed above, the <code>col_spec_diff</code> class is a list. Its values are either logicals or sets of column-specifications:</p>
<ul>
<li>
<strong><code>identical</code></strong> <code>logical</code>: are the two sets of specifications entirely identical?</li>
<li>
<strong><code>names</code></strong> <code><a href="https://rdrr.io/r/base/list.html">list()</a></code> with elements:
<ul>
<li>
<strong><code>identical</code></strong> <code>logical</code>: are the two sets of names identical (same and in the same order)?</li>
<li>
<strong><code>equivalent</code></strong> <code>logical</code>: do the two sets of names contain the same names, but in a different order?</li>
<li>
<strong><code>x_not_y</code></strong> <code>col_spec</code>: specifications for columns names that exist in <code>x</code> but not <code>y</code>.</li>
<li>
<strong><code>y_not_x</code></strong> <code>col_spec</code>: specifications for columns names that exist in <code>y</code> but not <code>x</code>.</li>
</ul>
</li>
<li>
<strong><code>specs_common</code></strong> <code><a href="https://rdrr.io/r/base/list.html">list()</a></code> concerning those names in common for <code>x</code> and <code>y</code>, with elements:
<ul>
<li>
<strong><code>identical</code></strong> <code>logical</code>: do the common names each have identical specifications? <code>NA</code> if no common names.</li>
<li>
<strong><code>x_diff_y</code></strong> <code>col_spec</code>: specifications in <code>x</code>, among common names, that are different from <code>y</code>.</li>
<li>
<strong><code>y_diff_x</code></strong> <code>col_spec</code>: specifications in <code>y</code>, among common names, that are different from <code>x</code>.</li>
</ul>
</li>
</ul>
<p>This function is separate from the rest of the infrastructure in the steward package. It is much closer to the infrastructure in readr and vroom; these packages are designed to read data, rather than to compare it. That being said, they both use the <code>cols()</code> infrastructure, and as best as I can tell, it is implemented independently in both packages.</p>
<p>Far be it from me to suggest anything to the Tidyverse team, but there seems to be an opportunity for another r-lib package, perhaps named <strong>colspec</strong>, that both readr and vroom could use. If such a package were to come to pass, perhaps this functionality could be part of such a package.</p>
</div>
<div id="extension" class="section level2">
<h2 class="hasAnchor">
<a href="#extension" class="anchor"></a>Extension</h2>
<p>As discussed earlier in this article, the function <code><a href="../reference/col_spec_compare.html">col_spec_compare()</a></code> does not take any action, it simply returns information on the comparison of two data frames.</p>
<p>However you might have a situation where you build a data frame, validate it against a reference (stopping if need be), then return your data-frame. Something like this:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>mtcars_new &lt;-</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="st">  </span><span class="kw">mtcars_building_function</span>() <span class="op">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="st">  </span><span class="kw">validate_col_spec</span>(mtcars) <span class="op">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="st">  </span><span class="kw">do_more_stuff</span>()</span></code></pre></div>
<p>Here’s a first idea on what <code>validate_col_spec()</code> might look like:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">validate_col_spec</span>(x, y, <span class="dt">predicate =</span> <span class="ot">NULL</span>) {</span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a>  is_identical &lt;-<span class="st"> </span><span class="cf">function</span>(diff) {</span>
<span id="cb14-4"><a href="#cb14-4"></a>    diff<span class="op">$</span>identical</span>
<span id="cb14-5"><a href="#cb14-5"></a>  }</span>
<span id="cb14-6"><a href="#cb14-6"></a>  </span>
<span id="cb14-7"><a href="#cb14-7"></a>  predicate &lt;-<span class="st"> </span>predicate <span class="op">%||%</span><span class="st"> </span>is_identical</span>
<span id="cb14-8"><a href="#cb14-8"></a></span>
<span id="cb14-9"><a href="#cb14-9"></a>  diff &lt;-<span class="st"> </span><span class="kw">col_spec_diff</span>(x, y)</span>
<span id="cb14-10"><a href="#cb14-10"></a>  </span>
<span id="cb14-11"><a href="#cb14-11"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="kw">predicate</span>(diff)) {</span>
<span id="cb14-12"><a href="#cb14-12"></a>    <span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(diff)</span>
<span id="cb14-13"><a href="#cb14-13"></a>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span>(<span class="st">"validation failed"</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</span>
<span id="cb14-14"><a href="#cb14-14"></a>  }</span>
<span id="cb14-15"><a href="#cb14-15"></a>  </span>
<span id="cb14-16"><a href="#cb14-16"></a>  x</span>
<span id="cb14-17"><a href="#cb14-17"></a>}</span></code></pre></div>
<p>For this function, you could supply a <code>predicate</code> function, which would take a single argument, a <code>col_spec_diff</code> object. It would return a logical that would indicate if execution should proceed. If the predicate is not satisfied, the <code>diff</code> object would be printed and execution stopped.</p>
<p>We could also imagine specifying that a predicate function would return a list containing the logical result, and an error message to pass to <code><a href="https://rdrr.io/r/base/stop.html">stop()</a></code>.</p>
<p>In this scenario, “we” would provide the <code>validate_col_spec()</code> function; “you” would provide the <code>predicate</code> function.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#under-the-hood">Under the hood</a></li>
      <li><a href="#extension">Extension</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ian Lyttle, Amanda Rae, Stephanie Reinders, Nikhil Agarwal, Ranae Dietzel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
